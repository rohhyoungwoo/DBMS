
-- 연관 서브쿼리
-- 최대 급여를 받는 직원 조회
SELECT EMPLOYEE_ID, FIRST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY = (SELECT MAX(SALARY) FROM EMPLOYEES);

SELECT MAX(SALARY) FROM EMPLOYEES;

-- 비연관 서브쿼리
-- 각 직원의 급여가 부서별 평균 급여보다 높은 직원 조회
SELECT EMPLOYEE_ID, FIRST_NAME, SALARY, DEPARTMENT_ID
FROM EMPLOYEES E
WHERE SALARY > (SELECT AVG(SALARY) 
   FROM EMPLOYEES
   WHERE DEPARTMENT_ID = E.DEPARTMENT_ID)
ORDER BY E.DEPARTMENT_ID;


SELECT DEPARTMENT_ID, AVG(SALARY)
FROM EMPLOYEES
GROUP BY DEPARTMENT_ID;

SELECT EMPLOYEE_ID, SALARY, DEPARTMENT_ID
FROM EMPLOYEES e;

-- 단일행 서브쿼리(서브쿼리의 결과가 하나의 행만 반환)
-- 가장 오래된 입사일을 가진 직원의 사원번호, 여름, 입사일 조회
SELECT * FROM EMPLOYEES
ORDER BY HIRE_DATE ASC;

SELECT EMPLOYEE_ID, FIRST_NAME, HIRE_DATE
FROM EMPLOYEES
WHERE HIRE_DATE = (SELECT MIN(HIRE_DATE) FROM EMPLOYEES);

SELECT MIN(HIRE_DATE) FROM EMPLOYEES;

-- 다중형 서브쿼리(서브쿼리의 결과가 여러행을 반환)
-- 특정 부서에 속한 직원 조회
SELECT EMPLOYEE_ID, FIRST_NAME, DEPARTMENT_ID
FROM EMPLOYEES
WHERE DEPARTMENT_ID IN (SELECT DEPARTMENT_ID
FROM DEPARTMENTS d 
WHERE DEPARTMENT_NAME = 'IT');

SELECT * FROM EMPLOYEES;

-- EXISTS 연산자 : 서브쿼리의 결과가 존재하는지 여부를 확인할 때 사용
-- 부서별 평균 급여보다 높은 직원 수
SELECT E.DEPARTMENT_ID, COUNT(*) 직원수
FROM EMPLOYEES E
WHERE EXISTS(
   SELECT 1
   FROM EMPLOYEES E2
   WHERE E2.DEPARTMENT_ID = E.DEPARTMENT_ID
      AND E.SALARY > (
         SELECT AVG(SALARY)
         FROM EMPLOYEES
         WHERE E.DEPARTMENT_ID = E2.DEPARTMENT_ID
      )
   )
GROUP BY DEPARTMENT_ID;

SELECT DEPARTMENT_ID, AVG(SALARY) FROM EMPLOYEES
GROUP BY DEPARTMENT_ID; --4150

SELECT DEPARTMENT_ID, SALARY FROM EMPLOYEES
WHERE DEPARTMENT_ID = 30;

SELECT * FROM EMPLOYEES;

-- 전체 평균 급여와 부서별 평균 급여 구하기
SELECT AVG(SALARY)
FROM EMPLOYEES; -- 1개 행

SELECT AVG(SALARY)
FROM EMPLOYEES
GROUP BY DEPARTMENT_ID; -- 12개 행




